defmodule LibTest do
  use ExUnit.Case
  doctest Lib

  test "sample case" do
    out =
      """
      ..@@.@@@@.
      @@@.@.@.@@
      @@@@@.@.@@
      @.@@@@..@.
      @@.@@@@.@@
      .@@@@@@@.@
      .@.@.@.@@@
      @.@@@.@@@@
      .@@@@@@@@.
      @.@.@@@.@.
      """
      |> Lib.calculate_adjacent_count()
      |> IO.inspect()

    expected =
      """
      ..xx.xx@x.
      x@@.@.@.@@
      @@@@@.x.@@
      @.@@@@..@.
      x@.@@@@.@x
      .@@@@@@@.@
      .@.@.@.@@@
      x.@@@.@@@@
      .@@@@@@@@.
      x.x.@@@.x.
      """
      |> String.trim()

    assert out.accessible_count == 13
    assert out.diff == expected
  end

  test "personal case" do
    # Total # of windows = len - count + 1
    out =
      File.read!("./priv/input.txt")
      |> Lib.calculate_adjacent_count()

    expected =
      """
      x@@x..x@x.xxxx@@@@x.x..x.xx.x...@@.x.x@x.xx..xx.x@@@@@....x..x@@.xx.x@@@@@..x.x.@@.x.x@.@@@x.xx@@..x.@@xx..x.x...xx..x..xxx.@@@x.x.xx@x
      .@@.@.@@@..@..@@@@.@.@@@@...x@x@@@@..@@@.@.@@@..@.@@@@@@..x..@@@@.@.@@@.@@@.@@.@@@@..@@@@@@@...@@@@.@@@..x@@@.@@...xxx.@.@.@@@@.@@@..@@
      x..@@@x..@@@.x@@.@@@.@@@@..x..@....@@@@.@.@@..x.x@....@@@.@@@@@@@@.@@@@@@@.@@@.@@@@x@@.@@@@@@x@@@@@@@.....@@.@@@@@@...@x@.@@.@.@@@...@@
      x..@@...@@@.x..@@@@@@@.@@@@...@@@.@@@@@.x@.@@.@@..@@@@@@@.@@.@.@..@.@.@@@@@@@.@..@...@@@@@@@..@@@..@@.xx.x...@@@@@x.x@...@@..@@@.@@.x.x
      @@@@@.x@@@.@..@@@@..@.@..@@@@@@@@@.@..@.@.@.@@x..@@@.@@@.@@.@@@.@@@.x....@@..@@@@@@.@.@@@..@.@.@.x.x.......x@@@@....@@@@@.@@.@@@@@.@@.x
      @@@@...x..@@.@.@..@@.@.@@@.@@@@@.@@@@.@@.x.@@...x@..x..@..@@@@@@@@@.x.x@@@@@@.@.@.x@@@@.@..@@@@...@..@@x.x..@..@@@@@..@@@@@@@.@@.@@@@@x
      .@..x....x@@@@@@@@@@@.@@@..@@@.@.@@@@@@@.x.@@.x...xx..x.@@.@@@@@..x.x@@.@..@@.x.x....@@.x@@@@.@@@@@.@@@..@@@@.@.@@@@..@.@..@@@@@.@@@@@.
      x@x.x@.x..@.@@@@@.@..@@@@.@..@@@@@@@..@@@.@@@@.@@@....@@@@.x..@@@.@.@.@@.x.@@..@@.....x.@.@@@.@@@@@@@@..x@@@@@@@.@.@@@@@x.x...@@@.@..@x
      @.@.@.@@...@.@@@.@...x.@@@@x.@@@.@@@..@@@.x..@@.@@@x@@@@@....@@@@@@@@@@@@.@@..@@.@@.x..@.@@.@.@@@.@.@@@@..@@.@@..x..@.@..@x.x@@..@@x..@
      @@@.@@@@xxx@@@@@.@@..x.@@@.@.@@.@..@.@@@@@....@@@@.@.@@@.@x.@@@..@@.@@@@@@.@@@@.@@@@..x.@x.@@.@@.@@@.@@@@.@.@@@x.x@.@@@@..@...@@@@...@@
      x@@@@@@.....@.@@@.@@..@@@.@@@@@.x@@@@@@@@@@.x@@.@..@@.x.@@.x.@@@@..@@...@@@@@.@..@@@@@.@...@@@@@@..@@@.@.@.@@@@..x.@@@@@x.@x.x@@..@@.@@
      ..@@@.@@x.x@@@@@@@.@@@.@@..@@@@.@.@@@@@@@@@.@@@@@@@@@...@@@...@@@..@@@@@@.@@@.@@.@@@@.@@@.@@.@@@@..@@.@@@@..@@@@.x.@@.@..@@.....@@@@@@.
      x@@@@@@@.@@..@..x.@@@@@@.@@@@@..@@@..@@.@@@@@.@.@@@.@@@@@.@@x.@..@@@@@@@@@.@@@@.@@@@.@@@@@@@@@@@@x.@..@@@@@@.@@@..x..@@..@.@xxx@.@..@@@
      x@@@@....@@@.x.....@@@@.@@@@@@@@@.@.@@@@@@.@@@@x..@@@@.@@@@.@@@.@@@@@@@.@@.@.@...@.@@.@.@@@@@.@@..@@.@@@.@@@.@@.x...x@@x.x@@...@@@@@@@x
      ..@@@@.x@@.@@x....@@@...@@@@@@@.@@x.@@.@@@@.@@...x@.@@.@@@.@@@@@@@..@@...@.@@.x.@...x.@@.@@@@@@@x.@@.@@@@.@@.@@.@@@...@...@.x@@@@.@....
      x@.@@@@..@@.@..xx.@@..x@@@.@@.@@@.@.@@@@.@@@@@.x..x.@@.@@.@@..@@.x.x@@..@@@@.x.xx@x.@.@@@.@@@.....x..@@@@..x..@.@@@@x.x@x.x..@@@.@@@x.x
      @@@@@@@.@@@@x...@@.x.x.@..x.@@@@@@@@.@@@@.@@@.@@x...@@.@@.@@x.@@.x..@@@@.@.@@.....@@@@@@@@@@@.x@@@..@@@@....@@x..@.@@..@@.x..@.@@@@@@..
      x..@@..@@@...@@..@.x..@@...@..@@@..@@@@@.@@@@@@.@.x@@@.@...@...@@@...@@@..@@@@.@@@@@....@@@@@@.@@x..@@@@@x.@@..@@@@@@@@@@@@.@@@.@@@@@.x
      ...@@@@...x.@@@@@.x.x@@.@@@@@.@@@x..@@.@.@@@@..@x.@@@@@@@x@@@@@@@.x.x..@@.@.@@@@@.@.@@x.@@..@@@......@@@.@@.@@@@@@.@@@@@@@@@@.x....@@@@
      .x@@@.x@@@@.@@@.@@....@@@.@@@@@@.x.x@.@@@.@@@@..x..@.@@..@..@.@@@@x.@@.x.@@@@..@@@@@@@..@.@@@@@.xx...@@.x.@@@.@@@@..@@@@@@.@....x...@@@
      .@@.@...@@@@@..@@..x@@.@...@@@@...x..@..@.x.@.xx..x@@@@..x.x.xx.@..@@@..@@@.@x.x.@@@@@@@@.@@@.@@..xx@@.....@@@@.@.@@@@@@@.x.@@@.xx....x
      .@@@.xx@.@.@.@@@@..@@@@@@@..@@@.xx...@@@.x..@@..@@..@@@x..x.....@@@@.x..@.@@.@..@@@.@@@@@.@@@@@.@@..@@@.xx.@@@@.@@@..@.@@.x.@@@@..x..x.
      .@..@..@@@@.@@.@@...@.@@@@@@.@....x.x@@@...x@@@@@@.x.@.@.@..x..@@.x.x..x.@@@@@@@@@.@@@@@@@@.@@.@.@@@@@.@.@@@..@@@@.@@@@@@@x.@@..@.@@...
      .x@@@..@@@.@@.@..@x@@@@@@@@@@@..x@...@.@....@..@.@@@..@@@@@@@@@@@....@@.@@.@@@@@@@.x.@@@@@@@@.@@@@@@@@@@@@@@x.x..@@.@@.@..@.@@@@@@.@@@x
      ..@.@@@@@@@..@@.@.@.@@@.@.@..@x..@@x@@@@...@..@@@@.@@@@@.@@.@.@@@@..x@@@@@.@@...@.@...@@...@@@@@.@.@@@@@.@@@....@@.@@.@@..x@@@@.@@@@@.@
      x@@@@@.@.@@@@@@@@@@@@.@@@@@.x..@@@.@.@@@@@@@@@@@@@@.@@.@.@@.x@@@@@@@...@@@@@@@.@@@x..x...x..@@@@@@@@.@...@@@@x..@@.@@@@@..@..@@@.@@@@@@
      @@.x.x.xx..@@@..@@.@@@@@.@@..@@@@...@@@@.@@@.@@..@.@@@@@@@...@@@@..@@@@.@@.@@@@.@.@.@.@@...x.@.@@.@.x.@@@@@.@..@@.@@@@.@@x.x@.@@.@.@.@@
      @@...x......@.x.@@...@@@.@@@.@@.@x.@@..@@..@@@@x.@.@@@@.@..x.@.@.@@@@@@@.@@@@@@@.@@@@@@@xx@.@@@@@.x...@@@...xx@@@.@@.@.@.@.@.@@@@.@x.x.
      x@xx@@.xx.x..x.@@@@.@@@@@.@@.@...@.@@..@.@@.@@..@@@@@@@@@@.x@.x.@@@@@@@@@.@@@@@@.@.@@@@...@@@@.@@x..x..@...@...@@@@@@@@.x.@@.@@.x@@..x.
      ....@@.@..@...x..@@@@@@.@..@@@@@@@@@..@@@@@@.x.x.@@@.@@@@@.@....@@@.@.@@@@@@@.@@@@@@..@@..@@@......xx..@@@@@@xx.@@..@@...@@@.x.....x..x
      x@x.@@@@@@@@x..x.@@@@.@@@@..@@@@@@@@.x@.@@@@@..@@@@@@..@.@@@.x.@@@@@@@@@@.....@@..@.x@@@@@@@@@@@@@...xx.@@@@.@....x@....@.@@..@x.x.@@@x
      .@@..@@@@@@.@@@x.x@@@..@@@@@@..@.@@@...@@.@@.x.@@@.@@@x..@@.@@@@..@@@.@@.x...@....@..@@@.@@@..@@@@@@@...@@@@@..@@.@.@x@@@@.@@@@@.@@.@@.
      ...xxx.@@.@@@@@....@@.@.@@@@@.xx.@@x...@.@@.@.@...x@@....@@@@.@@@@@@@@@.@.x.x@@.xxxxx@.@@@.@.x.@..@@@@x..@..@@@@@@@@.@.@@.@@@@@@.@@@@.x
      x@@....x...@@@@@.x...@@@..@@....@@....x@@@.@@@@@x...@@@@.@@@@@@@.@...@..@@.x..@@......@@@@.x@x.x.@@@@..@x.x@@@.@@.@@.x@@@@@@.@@@@@@.@.x
      @@@@@...xx.@...@@x...@@@@.@.x.x@@.@x...@@@..@@.@..x..@@@@@@@@.@@@.@.x..@.@..@@@@.x.x@@@@.@..@...@@...xx.@.x.@@.@.@@..@.@@@....@..@.@@@@
      @@.@@@x..@@@x..x..@@@@.@.@@@x...@@@.x..@.@@x..@@..x.x....@@@@@@@.@@@x.@@@@@@@@@@@@@@.@..@@@@@...x.x....@x....@@@.@@@@@@@.@.x@@@.@@.@.@@
      @.@.@@@..@@.x..x..@@@@.x.@@..x..@@.@.@@@.@.@.x.@@@@.@@.....x.@@@x.@..@@@.@@@@.@@@@@@@.@@@@@.@@x...@@.@@...x@@@@@@@@.@@.@@.@.@@.@@@@@@@.
      x@@..@@@@@@@..xx.x..@.@x.x.x@.@@.@@.@@.@@x.x@..@@@@@@.@@@@...@.....@@@...@@@@@..@@..@.@@@.@.@@.@@@x.@@@@@.@@@@.@@.@@@@.@@@@@.@@@@@@.@.x
      .@@@@..@..@.x...@.@@@@.@.@..@@@@@.x.@@.@....@.@@.@...@@@@@@@.@@x...@@@@..@@@.@.@@@@@x.x.@@@@@@@@@...@@@@@@..@@@..@.@@@@@.@@.@@@@@@@@...
      .@@.@@@@@@.x..x.x@@@@@@.@@@.@.@@@..@@..xxxxx.@.@..@@.@@@@.@@@.@..x@@@@@.@@...@@@..@@..@.@.x..@@@@@@.@...@@@.@@@.x@..@@@...@..@...@@.@@.
      .@@@@@..@.@...@@...@@@.@@@@@@@.@@@@@@@@.....x@@@@@@@@@@.@.@.@.@@@@.@@@.@.x..@@@@@@.@@@@@x....@@.@@@@.@xx@@@..@...@x.@@@@@@@.x..x@@.@@@@
      ..@@@@@@@@@.x@.@@x.@@@@@@@..@@@@@.@.@@@@@@....@..@..@@.@@@@.@@@@@@@@..@@@..@@@.@@@@@@@@.x.x.@@@x.@@@@@...@@.@@@x@..@@@@@@@@@@..x..@@@@@
      x@@@@@@..@@.x.@@..@.@@@@.@@@@@.@.@@@@@@.@@@.x@.@@@@@@@@..@.@.@@@@.@x..@@.@@@.@@.@@@@@....@@@.@.......@...@@@@@..@@@...@@.@@.@@.@.x@@@@.
      @@@..x.x@@....x.@@@@@@@@.@@..@..@..@@.@.@@.@.@@@.@..@@..x.x.@.@.@@...@@.@.@@.@.@@....x.x@@.@@@x.x.x@@@@x@..@.@..@@@..x..@@..@@@@@..@@.x
      .@.x.....@.xxx..@@.@@@@@@@.@@.@@.@@@@@@@@.@@@@..@@.@@..@@..@.x.@@@..@@.@@@@@x.@@...x..@@..@.@.@.@@@.@@.@.x@@@@x.@.@@.@@@..@@@.@@..x.@@@
      x...@x..xx.x..xx.@..@@@...@@@@@x.@@.@..@@.@@.@@@@@@@@..x@.@@.x.@@.@@.@@@@@.....@@x.@@..@@@@.x.@@@@@.@@.x@..@@.@.@@.@@.@.x@@@@@.@@@@.@@@
      @@@x.@...@.x...@.@@@@@@@@@...@...@@@.x@@@@.x@@@@@.@@.....@@.x..@.@@@@.@@...x.x@@@@.@@@@@@@@@..@@@@@@@..x......x@.@@.@.@@..@@.@@@@@@.@@.
      @@.@.@@@@@.@@@.@@@@@.@@@@@.x.x..x.@x...@@....x.@...@@@...@.@..@@@@.@.@@@@@@.@.@.@.@@@@@@..@@.@@.@@...x..@@x.....x.@@.@@@@..@@..@@.x.@@.
      @.@@@@@.@.@@@@@.@@@@@@.@.@@@.@@.x....x....xx....x@@@@@x.xx@@@.@@@@@...@@.@@@@.x@@.@@...@x.@@.@@..@@@@.@@@@@.x.x.x..@@@@@x.x@@@@.x.x.@@x
      @@.@@@@@..@.@@..@@@@@.@.@@@@@@@.x...x.@x..@..@@..@@@@@.....@@.x.@@.@@@@.x..@@..@@@.x....x.@.@@@.x@@.@@.@@.@.@@@x.x@@..x....@.@x.x.x.@..
      @@@@@.@@.xx@@@@@@@@..@@..@@...@.x...x@@@.@.x@@@@@@@@@@x.@@.@...@..@@.@@..@@@..x.@...@x...@@..@@@..@..@@..@@@.@....@@x...xx@.....x.@@@@x
      @@@@@@@.....@.@@.@@@@@.@@@@@..@@@.x@..@@@@@..@@@.@..@..@@@@@@@@@@@@.@@@.x.@@@@@..@@@@...@@@@x.@@@@@x@@..@@.x..x.x@....x..@.@@..@@.@@@@@
      .@@.@@@@@@x.x.@@@..@.@@@.@.@@.@@@.@.@@@@@@@@@@@@@@@..@@@.@@.@@@@@..@@.x.@@@.@@@@@@@.@@.x.@@...@.@@...@@@.x.x..x.@@.x.x@@@.@@@@@.@@@...x
      @@@@@@@.@@@..@x.x.x@@.@@@@@@@@@..x.@.@@..@@@@.....@@@@.x...@@@.@@x..@@..@@..@@.@@@..@@.x.@@@x.x@.@@@.@@@.x.....@@@.....@@@@@@@@@.@@@xx.
      x@.@..@.@@.@x......@x..@@@..@@...x.@@@@@x.@@.@@.x..@@...@x..@@@.@..@@@@@@.x.@@...@.x@@.@@@@.@@..@@@@@@@.@.xxx...@..x.x@@@..@@...@@@...x
      ..@@@@.@..@@....x.x....x@@@@.@@..@@@@@.@..@@@@@@..@@@@@@@.x.@@@.@@.@@@@@@@..@.@@@x.@..@@@@@@@...@@@..@@@@@..@@x.@@..@@.@.@@.@@.@@@.x.xx
      x@.@@.@.@@@.@.x.x..@@....@@@@@.@@@@.@@@x.@@@@.@@@@@@.@@@@...@@@@.@@..@..@@@@.@@@@..xx.x.@.@@@.x.@@@@@.@..@@@@.@.@@.@@.@@@@@@@.@@@@@x..x
      @@.@@@.@.@.@@@.@x.x@@@..@@..@@@@@@@.@@.@.@@.@@@.@..@@@..@@x@@@@@..@@@@.x@@@.x@@.@@.....@@..@@@@@@@.@@.x.@.@@@@@..@@.@@.@@@@.@@.@@@@...x
      x...@@@@.x@@@@@..@...@@@@@.x@@.@@@..x.@@.@@@..x.x@@@..@@@@..@.@@.@.@@@.@.@@...x..@@.x.x.@@.@.@@@@.@@..x@@@.@@.@@..@.@@@.@@@.@@@@@@@@@@x
      .@@@.@@.@...@..x.xx.x..@@..@.@@@@@@..@@@.@@@..x..@.@@@.@@..x@.@.@@@.@@@.x.@.x.x.@@.x.@..x.@@@.@@@@@@.x...@.@@@.@@x.@.@.@.@@.@@..@.@@.@.
      x@@@...@@@x.@@.x.....@@@@@@.@..@@@@@@@@@@.@..@.@@@@..@@@@@..@@.@.@@@@@..@.@@...x.@.x.xx..@@@@@.@..@@.x.x@.@.@.@@...@@@@@.@@..@@@@.@@.x.
      x.@@@.@.@..@@.@.x.x.x.@@@@@@.@@@@@@@@@.@@@x.x@@@.@@.@@@..@x@@@@@@@@@@@.@@@@@@..@.x@x.@..x@..@@@@.@@.@..@.@@.@@@@@xx.@.@@@@@.x.@@@@@..xx
      x.@@@@@@.x.@.@@.@.@@..@@@..@@.@@@..@@@@@@...x.@..@@@@@@.x...@@@.@..@.@@@@@@@.@@@@..x.@@.x.@..@@@@@@.@@@@.@.@@..@...x.@@.@@@.@.@@@.@@.@.
      x.@@..@.@.@@@@@@@@@..@@@@...@@@@@xx.@@@.@@.....x.x....@.@@.x@@@@...@@@...@@..@@@....@@@..@@@x.@..@.@.@.@@@.@@@@@.x..@@.@.@@@@@@@@@.@@.x
      x@@@@@@@@@@.@@@@.@@.@@.@@@@.@@@@......@@@@..x@@.@..xxx.@@@.@..@.@@@@.@@..@@@.@@@....@.@@@.@..@@@@@.@@..x@@.@@@@@.@@@@@.@@@@@@@.@@@@@@@.
      x.@@@@.@@.@.@@@@@@@@@.@@@@@@.@@@.x.x@@@@@@.@@.@@.x....@@@@@.@@..@@@@.@.@.@@@@.@.@@.@@..@@@@@.@@@@@@@.@....@@@@@@@.@.@@@@..@.@@@@@@@@@.x
      x..@.@.@@@@@@@@..@@@@@@.@.@@@@@..@@@.@.@..@@@.@.@.@@x.@@@..@@@@@.@@.@@@@@@.@@.@@@@@.@@.@..@@.@@@..@@@@@@@..@@.@..@.@@@@@...@@.@@@@@@.@@
      ..x.@@@@@@.@@@@@.@.@.@.@@@.@@@@@@.@.@@@@.x..@@@.@@.@@..@@@@@@@@@@@.@.@@@.@@@.@@.@@.@@@.x@...@@@@@@@..@.@@xx..@@@.@@@@.@@@@@@@@@@@@@.@@@
      .@.@@.@@@.@@.@@.@@@@.@@..@@.@@@@@@@@@.@.@.x.@@@@x.@@@..@@@..x.@@@@@@@..@.@..@.@@@.@.@@.@.@...@@..@@@.x@....@@x.@@@@.@@.@@.@@@...@@@@.@@
      xx@@.@.@@@.@.x...@@@@@.x.@@..@..@@.@@@.@@@@.@@.....@.x.@@@@....@@.@@.@@@@x.x@@@@@.@@@@@.@@@...@.x.@@.@..x@@@...@.@@@@@.@@@@@@..x.@.@@@.
      ...@@x..x.@@@...@@@@@@.x..@.@@@..@@.@@@@@@.@@@@x.xx.@@.@.@.@.x..@@@@@.@@.@.x..@@@@@@.@@@@@@.x@.x.@@@@@@.@.@.xx@@@@@..@.@@@.@@...@.@...x
      x@@@.......@@..x@@@@.@@.x.x@.@@x.x.@@@@@.@.@..@.@..@@@@x@.@@@.@.@@@..@@.@@...@@@@...@..@@@@.@@..@@@@@@@.@@@....@@.@@@@@@.@@@@@..x@@@x.x
      @.@.@xx..x@@@@@...@@.@@.x.@.@.@...@.@..@@@@@@x.@.@@@@@...@.@@@@@.@..@@@@@.@@@.@.@xxx.x..@.@@@@.@@@@.@@@@.@@@.@@@@@.@@@@@..@@.@@@..@.@@x
      x@@x.@...@@.@@@@@..@@@..x.x@x.x@..x@..x@@@.@@..@@@.@.@@.@@..x.@@@@@@@@@@.@@@@.x@....@..@x.@@..@@.@....@..@@@@@@.@@.@.@@@.@@@.@.@@@.@...
      .@...x.xx.x@@@.@@@@@.@@@@.@.@.@.x..@....@@@@@@@@@.@@.@@@@.x...@@@.@@@@@..@..@..@@@@@@.x.x..@@..@.x@x..@@@.@..@@@@.@@....@@@@.@@@@.@@.x.
      .x.x.@..@...@.@@@@@.@@@@@@@.@@@@x.x.@@.x.@.@@.@@@@@@.@..x.@@@x.@@.@..@@@@@@.xx.@@@@@@...x...@@@x..@@.@@.@@.@@@.@@.@@@@@@@@@.@@.@@..@@.x
      x.@@@@@@@@x@@.@@..@@@@@..@.x.@@@..@@@@@.@.@@@@@@@@@@@.x..@@@.@..@@x.x@@@@@.@..@.@@.@@@x.@@..@.@..x..@@@.@@@@@@@@@@.@@.@@@@@.@@@@...@@..
      @@.@@@.@.@..@@@@@@@@.@..@@@..x.@@@@@.@@@@@..@@..@@.@@.x.x@.@@@@.@.x.@.@@@.@.@@.@@.@.@.@@.@@@@..@x..@@.@@@@.@..@@@.@@.x@@@@.@@@@.@..x.@x
      @@..@.@.@x.x@..@@@..@..@@.@@x..@@@@@.@@@@..@@@.@...@@@.@..@.@@.xx..@@@.@@@@@@.@.@@@.@@@@x.@.@@@.@.@@@..@@@.xxx.@.@@@...@@@@@.@.@@@x..@@
      .@x.x.@@.x...@@.@@@@@.@@@@@..@@@.@@@..@@.@@@.@@@@..@@@.@@@.@.@...@@@@@.@@@@@.@@..@@.@@@...x@.@@@.@@.@@@@.@@...@@@@@@@x.@@@..@.@@.@...@.
      ..@.@.@@.x.x@@.@@@@.@@@.@@.@@.@@@...x.@.x.@@@@@@@@@..@.@@.@@@@@.x.@@@.@@@@@x.@@@.@@..@@.x..@.@..@@@@.@@.@@@x.x@..@@.@.@@@@@@.@@.@.x.x.x
      x.x@@@@@..@@.@@.@..@@.@..@.@@..@@x..x.x@..x...@.@@@@@.@@@@@..@@.x@@.@.x.@....@@.@@x.x.@@@@.@@@@@.@..@.@@.@.@..@@@@.@.@..@.@@@.x.x@@.@@x
      x..@.@@@@@@..@@@@@.@@@.x@@.@.@@.x..xx..@@@...x.@@@.@@@@.@@.x.@@.x.@@@@..@@@xx..x....@@@.@@@.@@@@@@@@@@@.@..@@x@@@@@@@@.x..@.@.x..@@@@..
      .@.x.@.@.@@@.@@@@@@.@@..@@@@@@@......x.x@@.x.x..@@@.@.@@@@.x@.x.x..@@.@@.@@..x..xxx@@.@@@@@..@@.@@@@.@@@.@@@...@.@@@@@@..x.@@@.x.@@@..x
      @@@@.@@..@.@@.@@@..@.@@@@.@.@.@.x.x@@@....@@@.@@@.@.x.@@.@..@...x.@@.@@@...x.@@..@..x.@@@.@.@@@..@@.x.@..x@@@..@@@.@.@@@@x.@@@.x..@@@..
      @@@@.@@..@@@@@.@..@@.@@..@.@x.@@.@@.@@@.@@@@@@.@@@@@.@@.@@.@@@x.x@@@@@.@..@.@@.@@@x...@.@@@@@.x.@@@..xx....@@.x@.@@@@.@@..@@@.@@...@.@.
      x.@@.@.@@@@@@.x.x@@@@@@@@.@...@@@@.@@.@@@@@...@@.@@@.@@@.@@.@@@..@@@@.@.x@@@@@@@.@...x.@@@.@@..@@@.@......@@@..@@.@@.@@@@@.@@@@@x.@@@@@
      ..@@@@@@..@@@...@.@@.@@@@@@@.x@@@@@.@@..@.@@x.@@...@@.@@.@..@@..x@@@.@@..@@.@.@@@@@x.x@@@@@@@.@@.@@@@@@x@x.@@.@@.@@..@@.@@.......@@..@@
      x.@@.@@@x.@@@@@@@...@.@@@.@@.@.@.@@@@.x@@@@.@@..@x@x.x..@@@@@@...@@@@@@@@@..@@@.@@@...@@@.@..@@@@@@.@@.@.@..@.@@.@@@.@.@@@.xxx@@@.@.@@@
      ..@@.@@..@..@@@@@..@@@@@@@.@@@.@@@.@x.@..@..@@.x.@....xx.@.@.@@x.@@..@@@.@@@@@@@@@@@x@.@.@...@@@.@@.@@..@.@.@@@..@@@@@.@@@@...@@@@@@@@@
      ..x.@.@.@@@@@.@.@@@@.@...@@@.@@@@@@...@@.@@.@..x..x.x...@...@@.@..@@.@..@@..@.@@.@@..@@@@@@@.@@@..@.@@@@@@@@@@@..@@@.x@@..@@x@@.@@@@.@@
      x..@@.@@@.@.@@@@.@@@@@..@@@@@@.@@@@.xx@@@.@@x.xx.@@..x@@@@..@@@@@..@@x@@@@@x.@...@@@..@@.@@@@@@.x.@@.@..@.@..@.xx..x....x@@..@@@@.@@@.x
      ..@@@@@.@@@@@@@@..@@@.@@@@.@@@..@@.....@@.@.....@@@..@.@@@@@@..@.x@@...@@@..x.xx@@@@@@@x.x.@@@..@@.@@.x.x@@@@@..x..@.x..@.x..x.@.@@@@..
      xx.@@@.@..@@.@@..@@...@@@.@@@@@@@@@..x@.@@x.x.x@...@@@@@.@@.@x@@...@@..@@@...@..@@@@@@...x..@..x.@@.@@x...@@@@@@..@@@x.@@@...x.@@@.@x..
      x...@@.@@.@@@.@@.@@@xx@@@@.@@.@@@@.x@x.@@.@.@.@.@@@@@@@@.x.@...@@@@@.@@.@@.x@@..@@..@@...x@@@@.@..@@@@....@@@@.@@@@@..@@@@@@@..@@......
      .@.@@..@@..@@@@@@.@.....@@@@@.@.@x.@...@.@.@@@.@@@.@..@@...@@@@@@.@@@@@...x..@@@@@@@@.@@@..@@@@@x.@@@.@..@@@@@@@@.@...@@..@@@xx....xxx.
      x@@.@@@@.x..@@@.@@@@@x.@@.@@.x.@...@@x.@@@@.@@@@@@..@@x.@@@@@.@@@..@@@@@.x..@@@@@@@..@@@@...@@@..@@@@@@@@@@@@@.@.@x.@@@@.@@@........@..
      @.@@@@.@.@@x@@@@@@@@@.@@.@@@...@@.@@@.x.@.@@@@@@@@@@@...@@.@@.@@.xx.@.@@@@.@@@.@.....@@@@..x...x.@.@@@..@@@..@@@@..x@@..x.@@@@.x.x.@@@x
      x@.@@@.@@@...@@@@@..@.@@@...xx@@@.@@..x.x.@.@@@@.@@.@@.@@@@@@@@@....@@@@@.@@.@.@@xx.@.@@@....x@@.x@@@@.@@@@.@@.@@x....@x..@@@@@..@@@@.@
      @...@@@.@..x@@.@@@@.@@@.@.@@..@@@@..x.@@.@.@@@@@.....x@@@.@@@@@@..@@@.@@.@@@@@@@..@@@@.@@@xx..@@..@..@@@.@@@@.@...@@.@.@.x...@@@@.@@.@x
      xx.x@@@.@x..@@@@@@@@@@@.x@@@.x.@.@@@.@@@@@@.@@@@.x......@@@.@@@@@@@@..@@@@@@.@@.@@@@@...@@...x.@@x..x.@@@@@@.@@@x.@@@@@.@.xx@@@.@@@@@@.
      x..@..@@.x..@@....@.@@@..@@@.@@x@.@@.@@@@@@@@@@..xxxx@@@@@@@@@..@@@@@.@@..@@@@@.@@@@@@@@@..@@.@@@..x..@@@....@@.x.@@@@@@@...@..@@.@@@.x
      ...@@..@@..@.@@x@@@@@@@.@@.@@@...@@@@.@@@.@@.@@@@....@@@@@.@.@@.x.@@.@..@.@@@@@@@@@@@.@@@.@@@@..@@@..@@.@x.x@@@.x.@@@@@@@@x.x@@@.@.@@@x
      xx@@@x..@@@@@@..@@@@@@.@@@.@@.@.x.@@@@@.@@..@@@@@...@@@@.x@x@@@..@.@@@xxx@@@@@.@@@.@@.@@@@@@@x..@@@.@@@@..x.@@.@.@@..@@.@@@..@@@@@..@@.
      ..@@...@@@@.@..@@@.@@.@@@@@@@@@@.@@@..@@.@@@.@.@@.@@.@@@.....@.x.x@.@......@.x.x@@.@@@@@@@@....@@@@@@...@..@@.@@@@...@@@@@.@@@@.@@@@.x.
      .@@@@.@@...@@.@@.@..@@@@..@@.@@@.@@@@@@..@@@@@..@@@@@..@.xx..@@@.@.@.@@x.x.x@....@@@@@@..@..x@@@.@@@@..@@@@@@.@.@.x.@@.@@..@@...@@@@..x
      x@@@@.@@..x.@@@@@x...@....@.@@@...@.@@@@.@.@@@@@@@...@@@.@@.@@.@@@@.@.@@..@..x.x.@@@...@@.@.@@.x..@@...@@@.@@@.@@..@@.@@@@@.@.@@.@@.@@@
      @.@.x.@@@@@.@..@..@@.x..x@.@@@@@..x.@.@@@@@..@@@@.x.x@@@.@@@.@..@@@@@@@@@@@@@.@@.@.@@x.x@@@@@...x@@.@x.x@@@@@.@@@.@@.@@@..@@@@@@@@.@.@@
      x@x..x.@.@@@.@@..x@@@.xx.@@.@@@@....x@..@.@@@@..@.x.@.@.x.@@@@@.@@.@.@@..@.@.@.x@@@@@@....@@@@.@..@.@@.....@@@@@@@@@..@..@@.@....@@@@@.
      x......@@@@.@@@@.@...@..@@....@.x...@..@@@.@@.@@@..@@.x..@.@..@@.@..@@...x..@@...@@@@@@@@.@.@@@@x@@..@x..x..@.@@...x...@@@.@@@@x.@@.@.x
      .x..xx.@@.@@..@@@.x.@@@@@@@@@@@@.@@@@@@.@@@@@@@@@@@@@.@..@@.x@@@.@@@@@.@@@.x.xxx@@@@..@@@@.@@@@...@@@..@@@x.x.@..@@..@@@@@.@@@.@@@.@@@.
      .@@@@..@.@@@@@...@@.@@@.@..@@@@@@@.@@@.@.@.@@@@@@@@..@@@@.@@..@@@.@@..@@@.@@....@@@@@@@@@@@@.@@@@.@.@@@@@..@.@@@@@@@@@@..@@@..@@@.@.@.x
      @@.@@@@@@@@@@@@.@@@.@@@@@@@@.@.@.@@@@@@@@@.@@.@@@@@..@@@@@@...@@@@.@@..@@.@@@@@.@@...@@@@@@.@.@@@@@@@.@.@@@@@..@.@.@@@@.x.@@.@@.@@@@..x
      @@@.@.@@...@@.@@@@@.@@@@@..@@x.x.@@..@@@.@@.@..@@.@.@.@.@.@@@@@@@@@@@@@@@..@@@@@@@..@.@@@@@@@@.@@.@@@..@@.@.@@..@@.@@@..@@@.@@@@...@x.x
      .@@@...@@x.@.@@@@@@@@.@..@@...@@.@@..@...@@@.@@@@.@@@@@@x@@.@@.@@.@@..@@@.@@@@.@.@@@@@@@@@.@..@@.@.@@@@@@@..@@@@@@.@..@@@.@@..@.@x@@...
      ..@@.x.@@@.@@@@@@@@.@@@@@@@@@@@@@.@.x@.x.@..@@@@..x@@@.....@@.@@@@@@@...@@@@.@@@@@.@@..@@@.@@@@..x@.@@.@@.@@.@@.@.x.@@.@@@@.xx@@@..@..x
      .@@@@@@@@@@@@@.@@@.@@@@.@@@@.@@@.@@..@@@@@.@@@@@@...@@@.@x.@@..@...@@@@.@@@@@.@@@@@@@@@@@@@@@.@@@..@@@@@..@@..@.@.x.@@@..@@@...@@..@@..
      x.@...@@@@@@@@@@@@.@@@@@@@@@@@@@.@@x.x.@@@@@...@@.x@@.@@@@.@@...@x.@.@@@..@..@@@@@.@@.@..@.@@.@@@@@@@..@..x.@@@@@@.@@@.@@...@x@.@@@@@@x
      x@.x.@@@..@.@@@@.@@@@.@@@@.@.@..@@....@@@@@@@x@@.@@.x@@@@.@..x.@@.@@@@@@@@@x@@@@@.@@@@..@@@@@.@@.@@@.@@@..x.x@.@@@@@.@@@.x.@.@.@@.@@@..
      .@..@@@..@.@.@.@.@@@@@@@@@..@..@@@@@@@.@@@.@..@.@@......@.@@x.@@@@@.@.@@.@...@@@@.@@.xx.@@.@.@@.@@@@@@.@@@@...x@@@@.@.@@.@@@@x.@@.@@@.x
      x@.@.@@.x@@@@@@@@@@@@...@.x.@@@.@..@@.@@.@..@@@@..@@@@x@@@@..@.@@@.@.@.@@..x@@@@.@@@....x...@@@@@@...@@@@@@@x.....@@@@..@.@@.@.@@@..@@@
      x.@@@@@..@@@@..@.@@@@@.@.@.@@.@@@@@@.@@@.@@@@@@.x.x@@.@.@@@x.xx.@@@@x.@@@x.@@@@@@@@.@x...@@@@@@@@@@x.@@@.@@..x@@@.@@.@@xx.@@@@@@@@@x@@x
      .@@@..x..@@@@@@@@@@.@@@@@.@.@..@@@.@.@@@@@@.@@@@@...@@.@@@@.....x.@...x...@@@@@@@@@@.@..x@@@@..@@@@.@@@.@@...@.@@@@@@@....@@@@..@@.....
      x..@@..@.@@..@@@@@..x.@..@.@.@.@@@@.@@@.@.@@@.@@@@x.@@@@@.@.xxx.x.@@x.x...@@@@@.@.@@@@...@.@@x.@.@@.@.@.@@@@@@@@@.@@@@@x.x...@@@@.x.xx.
      x.x.@@@@@@@@.x.@@..x..@@@@@.@@@@@@...@@@@..@@..@@@@.@@.@@.@@.@...@@...x..x.@@@.@.@.@@.x.@@@@...@@@@@@@@@..@@@@..@@@@@@@@......@@@...x..
      @@.@@@@@.@@@@..@@.x.@@@..@.@@@.@@@x.@@@@@@@.x.x@@.@@@....x.@@@@xx..@@x.x.@@.@.@x.@@@@..@@@@@..@@.@@@@.@..x@.@@@@@@.@@.@.x..x..@.@@..@.x
      @@..@@@.@..@..x@@@@.@@.x@@@@@.@..@..@@@@..@@...@@@.@@.x@..@@@@.@..@@@..@@@..@@@..@@@.xx...@@@@.@@@@.@@@x...@@@.@@@.@..x@@.@@.@@@.@@@@@@
      .x.x.@@@@@@@@x..@@@@@x..@@.@..x@..@@@..@@@@@.x@@.@@.@.@@@@.@.@@@@@@@.@@@@@.@@@@@@@@..x..@@@@@@@x.@@@.@...x@.@@@.@@.@x..@@@@@@@@@@@@..@@
      x..x..@@@@.@.@.x.@.@....@.@@@..@@@@@@.@@.@@..@..@..@@.x..@@@@@..@@.@@@@@..@@@@@@...@@..@@@@@.@....@@@..x.x.x.@.@@@@.@.x@@.@..@@@@@.x.@@
      @@...x@@.@@.x.@.x.@@.xxxx.@@@@@@@.@..@@@@@@x.x@@.x.@@@..@.@@.@@@@.@.@@@@.@@@...@@@@@@@@@.@@..@@x.x.@.@@..@..@@.@@@@@@..@.@x.x.@@.@.x.@@
      @@@@..@...@..@x..@.@@@...@@@@@@@x.x@.@..@.@..@.@@@.@@.@@@@..@@@@@@x..@@.@@@.xx.@.@@@@@@.@@.@@@@.x.@..@@@@@@@@@@.@.@@@@@@.@..x.@.@x@.@.@
      @.@@@@@@x@.@@@..x.@.@.@x..@...@....@@x..@@@.@x..@@x..@@@@@@@@.@@....@@@@@@@@..x.@@@..@.@@@.@@@@...x@x..@@@@@.@@@@@.@.@@.@x..@@@@...x.@x
      x@.@..@..@@@@...x.@@.@@@..x.x@@...@@..x.@@@@.x..x...@@@@@.@.@@@.@@@@@@.@@@@@@..@@...x..@@@@.@.x.x.@..@@@@.@@.x..@.@@@@@@..@@@@.x.....x.
      x.@.@@@x@@@@.xx..@@.@.@@@@@..@@.x@@@@.x.@.@@@..x....@@@@@@@@@@@@.@@@.@@.@.@@@@.@@@x.@...@.@@.@...@@.x.@@@@@@.@.@@@@@@...x.@@.@..xx.x..x
      x.xx.x...@@x.x.xx.x@x@@@@@.xx@@x.@@@x.xx.x@@x..xx.xx...@@.@@@@@x.x@.xx.xx@@@.xx.@@.xxx.xx.x.x.x.xx.x.xx.x.@@@x@x.x..xx.xx.x..xxx..x.xxx
      """
      |> String.trim()

    assert out.accessible_count == 1384
    assert out.diff == expected
  end

  test "sample case - challenge 2" do
    out =
      """
      ..@@.@@@@.
      @@@.@.@.@@
      @@@@@.@.@@
      @.@@@@..@.
      @@.@@@@.@@
      .@@@@@@@.@
      .@.@.@.@@@
      @.@@@.@@@@
      .@@@@@@@@.
      @.@.@@@.@.
      """
      |> Lib.clean_all_possible_rolls()
      |> Enum.at(-1)

    expected =
      """
      ..........
      ..........
      ..........
      ...x@@....
      ...@@@@...
      ...@@@@@..
      ...@.@.@@.
      ...@@.@@@.
      ...@@@@@..
      ....@@@...
      """
      |> String.trim()

    assert out.diff == expected
    assert out.total_cleaned == 43
  end

  # This is waaaaaay too slow! 133seconds!
  @tag timeout: :infinity
  test "personal case - challenge 2" do
    out =
      File.read!("./priv/input.txt")
      |> Lib.clean_all_possible_rolls()
      |> Enum.at(-1)

    assert out.total_cleaned == 8013
  end
end
